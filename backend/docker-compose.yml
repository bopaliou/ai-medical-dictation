version: '3.8'

services:
  backend:
    build: .
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - NODE_ENV=production
      # Ces variables doivent être définies dans votre fichier .env sur le serveur
      # ou injectées via l'environnement CI/CD
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - SUPABASE_STORAGE_BUCKET_AUDIO=${SUPABASE_STORAGE_BUCKET_AUDIO}
      - SUPABASE_STORAGE_BUCKET_PDFS=${SUPABASE_STORAGE_BUCKET_PDFS}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - JWT_SECRET=${JWT_SECRET}
      # Configuration Whisper spécifique au conteneur (déjà définie dans Dockerfile mais surchargeable ici)
      - WHISPER_BIN_PATH=/app/whisper.cpp/main
      - WHISPER_MODEL_PATH=/app/whisper.cpp/models/ggml-large-v3.bin
    volumes:
      # Optionnel : monter un volume pour les logs ou uploads temporaires si nécessaire
      - ./logs:/app/logs
    restart: unless-stopped
